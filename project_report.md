# Software Verification and Validation Report
## ERP Backend - Smart Relations Module

**Date:** January 2, 2026
**Project Group:** (Your Group Name / Individual)

---

# 1. INTRODUCTION

## 1.1. Purpose
The purpose of this document is to report on the Verification and Validation (V&V) activities performed for the **ERP Backend System**, specifically focusing on the newly implemented **Smart Relations & Dynamic Event System**. This report details the testing strategies, test cases, and results used to ensure the software meets its functional requirements and structural integrity.

# 2. VALIDATION

## 2.1. Objectives and Scope of the Software
The ERP Backend is an Enterprise Resource Planning system designed to manage core business entities such as Companies, Orders, Invoices, and products.

The specific scope of this V&V activity covers the **"Smart Relations"** subsystem, which allows:
1.  **Dynamic Relationship Management**: Users can link any two entities (e.g., A `Company` to a `Customer`) with a specific relation type.
2.  **Event-Driven Architecture**: The system listens for updates on "Source" objects.
3.  **Rule Engine (Smart Triggers)**: Users can define JSON-based rules (e.g., *"When Source Status becomes ACTIVE, set Target Status to VIP"*).
4.  **Automatic Synchronization**: The system automatically updates target entities based on these rules.

## 2.2. Software Life Cycle
The project follows an iterative Agile development lifecycle. This report covers the "Implementation" and "Testing" phases of the current iteration, specifically addressing the transition to a **Lombok-free** architecture to ensure compatibility with modern JDKs (JDK 21+).

# 3. VERIFICATION

## 3.1. Formal Verification
While formal mathematical proofs were not applied, static code analysis was performed during the "Delombok" process to ensure:
*   Type safety in manual constructor verifications.
*   Correct usage of Jakarta Persistence (JPA) annotations (`@Entity`, `@OneToMany`, etc.).
*   Removal of potentially unsafe "magic" code generated by Lombok.

## 3.2. Testing Strategy
A multi-layered testing approach was adopted to verify the software at different levels of abstraction:
1.  **Unit Testing**: To verify individual components (Services, Listeners) in isolation.
2.  **Integration Testing**: To verify the interaction between components (Database, Events, Services) in a real-world scenario.
3.  **Controller (API) Testing**: To verify the HTTP interface, status codes, and input validation.

# 4. TEST RESULTS

## 4.1. Functional Testing (Black-Box)
Functional testing focused on validating that the system behaves as expected from an end-user perspective.

**Component Tested:** `ArcRelationIntegrationTest`
*   **Objective**: Verify the End-to-End (E2E) flow of the Smart Trigger system.
*   **Scenario**:
    1.  User creates a Source entity (`Company`).
    2.  User creates a Target entity (`ArcObject`).
    3.  User defines a "Sync Rule" linking them.
    4.  User updates the Source entity.
    5.  **Expectation**: The Target entity is automatically updated by the system.
*   **Result**: **PASSED**. The test confirmed that the `ArcObjectUpdatedEvent` was correctly fired, captured by the `ArcRelationListener`, and the target data was updated in the database.

## 4.2. Structural Testing (White-Box)
Structural testing focused on internal logic paths, error handling, and component isolation.

### 4.2.1. Service Layer (`ArcRelationServiceTest`)
*   **Objective**: Verify business logic and exception handling.
*   **Test Case 1: Create Relation (Positive)**
    *   **Input**: Valid SourceID, TargetID, RelationType.
    *   **Logic Verified**: Repository `save()` is called once.
    *   **Result**: **PASSED**.
*   **Test Case 2: Duplicate Prevention (Negative)**
    *   **Input**: Attempting to create a relation that already exists.
    *   **Logic Verified**: Service identifies the duplicate via `findBySourceTypeAndSourceId` and throws `IllegalArgumentException`.
    *   **Result**: **PASSED**.

### 4.2.2. Event Listener Layer (`ArcRelationListenerTest`)
*   **Objective**: Verify the Rule Engine logic.
*   **Test Case 1: Rule Match**
    *   **Condition**: Source field matches the trigger value defined in JSON settings.
    *   **Logic Verified**: `targetObject.save()` IS called.
    *   **Result**: **PASSED**.
*   **Test Case 2: Rule Mismatch**
    *   **Condition**: Source field does *not* match the trigger value.
    *   **Logic Verified**: `targetObject.save()` IS NOT called (Event is ignored).
    *   **Result**: **PASSED**.

### 4.2.3. API Layer (`ArcRelationControllerTest`)
*   **Objective**: Verify HTTP Contract.
*   **Methodology**: Used `@WebMvcTest` with `MockMvc`.
*   **Test Cases**:
    *   `POST /api/relations`: Verifies JSON serialization and `200 OK` response.
    *   `GET /api/relations`: Verifies query parameter handling (`sourceType`, `sourceId`).
    *   `DELETE /api/relations/{id}`: Verifies `204 No Content` response.
*   **Result**: **PASSED**.

# 5. TEST INSTANCES

## 5.1. Resolved Test Incidents
During the verification process, the following critical issues were identified and resolved:
1.  **Missing `@Entity` Annotations**:
    *   **Incident**: `mvn test` failed with `UnknownEntityException`.
    *   **Cause**: During the manual refactoring (Delombok), the `@Entity` annotation was accidentally omitted from `CustomerEntity`, `ProductEntity`, `OrderEntity`, etc.
    *   **Resolution**: Annotations were restored, and Hibernate successfully mapped the tables.
2.  **Lombok Compatibility**:
    *   **Incident**: Version conflicts with JDK 21 caused build failures.
    *   **Resolution**: Completely removed Lombok dependency and replaced all annotations (`@Data`, `@Builder`) with standard Java getters, setters, and constructors.

## 5.2. Unresolved Test Incidents
*   **None**. All tests (Unit, Integration, Controller) are currently passing (`Tests run: 9, Failures: 0`).

# 6. RECOMMENDATIONS

Based on the V&V activities, the following recommendations are proposed for future development:
1.  **Adoption of TestContainers**: Currently, tests run on H2/SQLite. For better production parity, moving to `TestContainers` (Dockerized PostgreSQL) is recommended.
2.  **Expanded Rule Engine**: The current "Smart Trigger" system supports simple "Value Mapping". It is recommended to expand this to support conditional logic (e.g., "Greater Than", "Regex Match").
3.  **Continuous Integration (CI)**: The automated test suite (`mvn test`) is robust and should be integrated into a CI pipeline (e.g., GitHub Actions) to run on every commit.
